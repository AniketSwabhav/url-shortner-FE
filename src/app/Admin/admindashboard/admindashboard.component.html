<div class="container mt-3">

  <!-- Flash Messages -->
  <div *ngIf="flash.message"
       class="alert"
       [ngClass]="{
         'alert-success': flash.type === 'success',
         'alert-danger': flash.type === 'danger'
       }">
    {{ flash.message }}
  </div>

  <!-- Search -->
  <div class="input-group w-50 mb-3" [formGroup]="searchForm">
    <input type="text"
           formControlName="searchTerm"
           placeholder="Search by Email or Username..."
           class="form-control" />
    <button class="btn btn-primary" (click)="searchUsers()">Search</button>
    <button class="btn btn-outline-secondary" (click)="clearSearch()">Clear</button>
  </div>

  <!-- Users Table -->
  <table class="table table-bordered table-hover text-center">
    <thead class="table-dark">
      <tr>
        <th>Sr No</th>
        <th>Full Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Role</th>
        <th>Active</th>
        <th>Wallet</th>
        <th>URL Count</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users; let i = index" [class.inactive-user]="!user.isActive">
        <td>{{ i + 1 + offset }}</td>
        <td>
          <a [routerLink]="['/admin/view-user', user.id]" class="text-decoration-none">
            {{ user.firstName }} {{ user.lastName }}
          </a>
        </td>
        <td>{{ user.credential.email }}</td>
        <td>{{ user.phoneNo }}</td>
        <td>{{ user.isAdmin ? "Admin" : "User" }}</td>
        <td>{{ user.isActive ? "Yes" : "No" }}</td>
        <td>{{ user.wallet  }}</td>
        <td>{{ user.urlCount }}</td>
        <td>
          <ng-container *ngIf="user.isActive; else reviveTemplate">
            <button class="btn btn-sm btn-warning me-2" title="Disable" (click)="onDisableClick(user.id)">
              <i class="fas fa-user-slash"></i>
            </button>
            <button class="btn btn-sm btn-danger me-2" (click)="deleteUser(user.id)">
              <i class="fas fa-trash-alt"></i>
            </button>
            <button class="btn btn-sm btn-info me-2" (click)="onTransactionClick(user.id)" >
              Transactions
            </button>
            <button class="btn btn-sm btn-secondary me-2">
              View URLs
            </button>
          </ng-container>
          <button class="btn btn-sm btn-primary me-2">
            Update
          </button>
      

          <ng-template #reviveTemplate>
            <button class="btn btn-sm btn-success" (click)="onReviveClick(user.id)">
              Revive
            </button>
            <button class="btn btn-sm btn-secondary" disabled>
              Edit (Disabled)
            </button>
          </ng-template>
        </td>
      </tr>
      <tr *ngIf="users.length === 0">
        <td colspan="9" class="text-center">No users found.</td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <app-pagination
    class="p-0 m-0"
    [items]="users"
    [totalItems]="selectedButtonIndex ? usersCount : totalUserRecords"
    [limit]="limit"
    [offset]="offset"
    (pageChange)="changePage($event)">
  </app-pagination>

</div>
